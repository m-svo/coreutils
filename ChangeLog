2003-01-04  Jim Meyering  <jim@meyering.net>

	* src/remove.c (struct dirstack_state): Define.
	To be used in place of these file-scoped globals ...
	(dir_stack, len_stack, Active_dir): Remove globals.
	(ds_init, ds_free): New functions.
	(full_filename): Define.
	(full_filename_): Rename from full_filename.

	Begin to make AD_* functions more generic.
	* src/remove.c (AD_push_initial): Don't set status to RM_OK here.
        (AD_push): Likewise.
        (AD_INIT_OTHER_MEMBERS): Define.
        (remove_dir): Define the `status' member manually after each
        call to AD_push or AD_push_initial.

	* src/Makefile.am (check-misc): New rule, to ensure that no more
	S_IS* macro definitions sneak into the code.
	(check): Depend on check-misc.

	* src/remove.c [S_ISLNK]: Don't define.  It's already defined in sys2.h.
	* src/du.c (count_entry) [S_ISLNK]: Don't define.
	* src/shred.c [S_ISLNK, S_ISFIFO, S_ISSOCK]: Don't define.

2003-01-03  Jim Meyering  <jim@meyering.net>

	* src/true.c: Add copyright.
	(AUTHORS): I suppose I've written it.

	* src/Makefile.am (false.c): Make the generated file be read-only.

2003-01-04  Jim Meyering  <meyering@lucent.com>

	* src/ls.c: Include "dev-ino.h".
	[struct dev_ino]: Remove declaration.

2003-01-03  Jim Meyering  <meyering@lucent.com>

	Don't include trailing /. in diagnostics about directories.
	* src/remove.c (full_filename_): When FILENAME is just `.'
	and there is a nonempty directory-name part, don't append `/.'.
	* tests/rm/unread2: Remove trailing /. from diagnostic.
	* tests/rm/rm2: Likewise.

	When rm detects a cycle, don't abort the entire command,
	but rather just the affected command line argument.
	* src/remove.c: Include <setjmp.h>
	(struct dirstack_state) [current_arg_jumpbuf]: New member.
	(remove_cwd_entries): Call longjmp if we detect a cycle.
	(rm): Call setjmp here.

2003-01-02  Jim Meyering  <meyering@lucent.com>

	rm could be tricked into mistakenly reporting a cycle.

	* src/remove.c: Include cycle-check.h.
	[cycle_check_state]: New global.
	(remove_cwd_entries): Adapt to new semantics of cycle_check.
	(rm): Call cycle_check_init and cycle_check_free for each file.
	* tests/rm/cycle (rm): New test, for the above fix.
	* tests/rm/Makefile.am (TESTS): Add cycle.

	* src/cp.c (do_copy): Tweak diagnostic to be consistent with the one
	from mv: s/missing file arguments/missing file argument/.
	With --target-directory=DIR, cp and mv work with a single file argument.
	Reported by Karl Berry.

	* tests/rm/isatty: Enable this test.

2003-01-01  Jim Meyering  <meyering@lucent.com>

	* src/remove.c (cycle_check, is_power_of_two): Remove functions.
	Instead, include cycle-check.h and use it.

2002-12-31  Jim Meyering  <meyering@lucent.com>

	* src/remove.c (AD_push_initial): Don't set status to RM_OK here.
	(AD_push): Likewise.
	(AD_INIT_OTHER_MEMBERS): Define.
	(remove_dir): Define the `status' member manually after each
	call to AD_push or AD_push_initial.

	* src/ls.c [struct dev_ino]: Remove definition.
	Include "dev-ino.h" instead.

2002-12-28  Jim Meyering  <meyering@lucent.com>

	* tests/du/Makefile.am (TESTS): Add no-deref.
	* tests/du/no-deref: New script.

2002-12-23  Jim Meyering  <meyering@lucent.com>

	* src/remove.c (remove_cwd_entries): Fix typo in comment.

2002-12-21  Jim Meyering  <jim@meyering.net>

	* Version 4.5.5.

	* announce-gen: Generate MML-formatted announcement.
	This makes it a *lot* harder to send stale MD5/SHA1 signatures.

2002-12-20  Jim Meyering  <jim@meyering.net>

	* src/touch.c (touch): Change the wording of a diagnostic so
	that it makes sense both when the file exists and when it doesn't.
	Suggestion from Michael Stone.

2002-12-18  Jim Meyering  <jim@meyering.net>

	* src/stty.c (valid_options): Declare to be static.

2002-12-15  Jim Meyering  <jim@meyering.net>

	* Makefile.cfg: Remove rules related to generating m4/jm-glibc-io.m4.

	* src/chmod.c, src/copy.c, src/copy.h, src/cp-hash.h, src/csplit.c:
	* src/date.c, src/expr.c, src/fmt.c, src/id.c, src/install.c:
	* src/ls.c, src/od.c, src/pathchk.c, src/pr.c, src/remove.c:
	* src/shred.c, src/sort.c, src/stat.c, src/stty.c, src/sum.c:
	* src/tee.c, src/test.c: Remove all uses of `PARAMS'.

	* src/remove.c (PARAMS): Remove definition.
	* src/sys2.h: Likewise.

	* src/ls.c, src/stat.c, src/date.c: Remove declaration of nstrftime.
	Include strftime.h instead.

2002-12-14  Jim Meyering  <jim@meyering.net>

	* Makefile.cfg ($(url_dir_list)): Use .../coreutils, not .../fetish.

	* src/system.h [! HAVE_DECL_MEMRCHR]: Declare memrchr.
	This is necessary at least for Irix6.5 when using c89.
	Reported by Nelson Beebe.

	* tests/misc/Makefile.am (TESTS): Add cat-tty-eof.

	* tests/misc/cat-tty-eof: New test.

	* src/mknod.c (usage): Specify how major and minor mode numbers
	are interpreted.  Report forwarded by Kristin E Thomas.
	* src/mknod.c: Remove now-redundant usage-specifying comment.

2002-12-13  Jim Meyering  <jim@meyering.net>

	* Version 4.5.4.

	* tests/du/trailing-slash: Allow for a directory of size `0'.
	That happens at least on file systems of type tmpfs on linux-2.4.18.

	* announce-gen: New script to begin replacing the commands
	associated with the rule here...
	* Makefile.maint (announcement): Invoke announce-gen.
	* Makefile.am (EXTRA_DIST): Add announce-gen.

	* tests/cp/preserve-2: New file/test, for latest fix.
	* tests/cp/Makefile.am (TESTS): Add preserve-2.

2002-12-11  TAKAI Kousuke  <takai@vlsi.kuee.kyoto-u.ac.jp>

	Fix a bug whereby cp would fail to parse an option like
	--preserve=mode,ownership.
	* src/cp.c (decode_preserve_arg): Advance `comma' to
	point the character following the comma.

2002-12-11  Jim Meyering  <jim@meyering.net>

	* src/pathchk.c (NEED_PATHCONF_WRAPPER): Undefine before defining,
	in case it's already defined.

2002-12-09  Jim Meyering  <jim@meyering.net>

	* tests/touch/fail-diag: Don't get a test failure if /no exists.
	Instead, evoke a framework failure if /no-$$ exists.
	Reported by Michael Stone.

2002-12-08  Jim Meyering  <jim@meyering.net>

	* src/du.c (lstat) [! LSTAT_FOLLOWS_SLASHED_SYMLINK]:
	Define to rpl_lstat, so that even on systems like Solaris 2.8,
	du honors (per POSIX) the trailing slash on an argument referring
	to a symlink-to-directory.

2002-12-06  Jim Meyering  <jim@meyering.net>

	* Use autoconf-2.57.  Regenerate dependent files.
	* Use automake-1.7.2.  Regenerate dependent files.

	* src/ls.c (gobble_file): Also stat the file if it's a
	regular file and --indicator-style=classify (aka -F).
	Thanks to Ed Santiago for opening my eyes.

	* tests/ls/file-type: New file.  Test for the above.
	A test to contrast ls -F and ls --indicator-style=file-type.
	* tests/ls/Makefile.am (TESTS): Add file-type.

2002-12-04  Jim Meyering  <jim@meyering.net>

	* tests/ls/follow-slink: Make sure the symlink was created.
	Richard Dawe reported that `ln -s link link' succeeds, but creates
	no file on systems running some version of the DJGPP libc.

2002-12-03  Jim Meyering  <jim@meyering.net>

	* src/Makefile.am (AUTOMAKE_OPTIONS): Remove definition (to ansi2knr)
	since this package no longer panders to K&R compilers.

2002-12-02  Jim Meyering  <jim@meyering.net>

	* tests/du/slink: Skip this test if `.' is on a non-local file system.

	* tests/Fetish.pm (_at_replace): Do the substitution only if there's
	something to replace.

2002-12-01  Jim Meyering  <jim@meyering.net>

	* src/stat.c: Don't include <string.h> or <ctype.h>.
	That's already done via system.h.
	* src/dircolors.c: Don't include <ctype.h>.

2002-11-30  Jim Meyering  <jim@meyering.net>

	* ls.c (gobble_file): Remove the block of code that caused
	`ls --color -F symlink-to-dir' to list the files in
	`symlink-to-dir/.'.  Now, it prints `symlink-to-dir@', (just
	like `ls -F symlink-to-dir') but with the addition of highlighting.
	Similarly, `ls --color -dF symlink-to-dir' would print
	`symlink-to-dir/';  now it prints `symlink-to-dir@'.
	Reported by Jeff Sheinberg as Debian bug #168203.
	* tests/ls-2/tests (sl-F-color, sl-dF-color): New tests for the above.

	ls is now more efficient: with certain options, it no longer needs
	to stat each directory entry on systems with valid dirent.d_type.
	* src/ls.c (print_dir): Add DT_LNK and DT_REG.
	(main): Make --recursive set format_needs_type, not format_needs_stat.
	(gobble_file): Remove a FIXME comment, now that it's fixed.

2002-11-24  Jim Meyering  <jim@meyering.net>

	* src/du.c (du_files): Don't strip any trailing slash.
	Rewrite so that `/' is no longer represented internally as
	the empty string.
	(count_entry): When appending a file name component,
	account for the fact that the current path may end in `/'.
	François Pinard reported that `du symlink-to-dir/' was not
	equivalent to `du symlink-to-dir/.'.  Now it is.
	* tests/du/trailing-slash: New file/test, for the above fix.
	* tests/du/Makefile.am (TESTS): Add trailing-slash.

2002-11-23  Jim Meyering  <jim@meyering.net>

	* src/tac.c (output): Declare some local variables to be of type size_t,
	rather than `int' to avoid warnings from gcc.

2002-11-21  Paul Eggert  <eggert@twinsun.com>

	* src/ls.c (decode_switches): Use case-sensitive matching to
	decode the QUOTING_STYLE environment variable.  This is more
	consistent with the documentation, and with --quoting-style.

2002-11-21  Martin Buck  <martin.buck@ascom.ch

	* src/stty.c (struct speeds): Add support for all baud rates defined
	in linux-2.4.19.

2002-11-19  Jim Meyering  <jim@meyering.net>

	* tests/sum/sysv: Export LC_ALL=C, to avoid failure when
	run in a UTF locale.  Report and suggested fix by Bruno Haible.
	* tests/fmt/basic: Likewise.

2002-11-17  Jim Meyering  <jim@meyering.net>

	* configure.ac: Update via autoupdate.
	Add `AM_GNU_GETTEXT_VERSION(0.11.5)'.

	* src/mv.c (movefile): Don't remove trailing slashes from SOURCE.
	Reported by Hans Ginzel.

2002-11-15  Jim Meyering  <jim@meyering.net>

	* Makefile.cfg (gnu_rel_host): Define.
	(url_dir_list): Choose from (alpha|ftp).gnu.org depending
	on whether $(VERSION) looks like a major release number.

	* Makefile.maint (mail_gpg_sign_cookie): Backslash-escape `#'.
	(release): Rename from `alpha'.
	(alpha): Depend on release.

	* Makefile.maint (signatures): Define with ?=, so it's easy to override.

2002-11-14  Jim Meyering  <jim@meyering.net>

	* Makefile.maint (mail_gpg_sign_cookie): Make optional.
	(announcement): Use the new variable.

	* Makefile.maint: Sync with Bison, i.e.:
	(po-check): Scan .l and .y files instead of the
	.c and the .h files that they generate.  This fixes the bug
	reported by Tim Van Holder in:
	<http://mail.gnu.org/pipermail/bison-patches/2002-November/001352.html>
	Look for N_ as well as for _.  Try to avoid matching #define for
	N_ and _.
	From Paul Eggert.

2002-11-12  Jim Meyering  <jim@meyering.net>

	* src/ls.c (HAVE_SYMLINKS): Remove unnecessary macro definition.
	Replace sole use with equivalent `#ifdef S_ISLNK'.
	Inconsistency reported by Dmitry V. Levin.

2002-11-11  Jim Meyering  <jim@meyering.net>

	* src/stat.c (usage): Transform --help items output via s/ - /   /,
	so that help2man produces properly formatted man pages.
	Reported by Herbert Xu as Debian bug #168400.

2002-11-10  Jim Meyering  <jim@meyering.net>

	* src/ls.c (sighandler): Handle SIGTSTP specially.
	Based on suggestions from Solar Designer and Dmitry V. Levin.
	Add comments.

	* Makefile.cfg (cvs_files): Define.  From autoconf.
	(local_updates): Likewise.

	* src/ls.c (restore_default_color_handler, sigtstp_handler):
	Remove functions.
	(sighandler): New function, based on the one in sort.c.
	(main): Use sigaction, if possible; otherwise signal.
	Handle these signals:
	SIGHUP, SIGINT, SIGPIPE, SIGQUIT, SIGTERM, SIGTSTP.
	Don't register our handler if the signal is already being ignored.

	* src/dd.c (interrupt_handler): Use raise, rather than kill+getpid.
	* src/csplit.c (interrupt_handler): Likewise.
	* src/sort.c (sighandler): Likewise.
	(main): Declare `i' and `nsigs' to be unsigned, not int.

2002-11-09  Jim Meyering  <jim@meyering.net>

	ls --color: restore terminal text color upon signal.
	* src/ls.c: Include "full-write.h" and <signal.h>.
	(restore_default_color, restore_default_color_handler): New functions.
	(sigtstp_handler, put_indicator_direct): New functions.
	(main) [print_with_color]: Register signal handlers.
	Patch mostly by Solar Designer and Stanislav Ievlev.

	Update from autoconf.
	* Makefile.maint (AMTAR): Remove definition.
	(update, cvs-update, po-update, do-po-update): New rules.
	(wget-update): Update (thus renaming to cvs-update).
	(automake_repo): Use anoncvs@sources.redhat.com.

2002-11-06  Jim Meyering  <jim@meyering.net>

	* tests/misc/Makefile.am (TESTS): Add printf-hex.

	* tests/misc/printf: Be careful to test the code in this package,
	not the shell built-in function.

	* src/printf.c (print_esc): A hexadecimal escape sequence has
	at most two hex. digits, not three.  Reported by Padraig Brady.
	(usage): Update description.
	* tests/misc/printf-hex: New file/test, for the above fix.

2002-10-07  Paul Eggert  <eggert@twinsun.com>

	Add support for locale-specific size indications (e.g.,
	thousands-separators) and for explicit size suffixes on output.

	* doc/coreutils.texi (Block size): Say that:
	This affects display format as well as block size.
	Fractional block counts are rounded up.
	ls file size blocksize defaults to 1.
	A block size spec preceded by ' generates thousands separators.
	A suffix without a preceding integer generates suffixes.
	(tail invocation): 32k -> 32 KiB.
	(What information is listed): ls -h is now equivalent to
	ls --block-size=human, and ls -H is now equivalent to
	ls --block-size=si.  Displayed file size is now always affected by
	--block-size.

	* lib/inttostr.c, lib/inttostr.h, lib/imaxtostr.c, lib/offtostr.c,
	lib/umaxtostr.c: New files, taken from GNU tar.

	* lib/Makefile.am (libfetish_a_SOURCES): Add imaxtostr.c, offtostr.c,
	umaxtostr.c.
	(EXTRA_DIST): Add inttostr.c.

	* lib/human.c, lib/human.h: Rewrite to support locale-specific
	notations like thousands separators.
	Specify what includer of include.h must include beforehand.
	(human_group_digits, human_suppress_point_zero, human_autoscale,
	human_base_1024, human_SI, human_B): New enum values.
	(human_readable): Rename from human_readable_inexact; put the
	options before the sizes.  All uses changed.  The old human_readable
	function has been removed; use inttostr.h instead.
	(human_options): Renamed from human_block_size, with new signature
	that allows block sizes up to UINTMAX_MAX.  All callers changed.

	* m4/prereq.m4 (jm_PREREQ_HUMAN): Check for locale.h, localeconv,
	AC_HEADER_STDBOOL.  No need to check for limits.h since it's in
	freestanding C89.  No need to check for stdlib.h or string.h since
	autoconf does this now.

	* src/cksum.c (cksum): Use primitives from inttostr.h, not
	human.h, to print large numbers simply.
	* src/csplit.c (handle_line_error, parse_patterns): Likewise.
	* src/dd.c (print_stats, main): Likewise.
	* src/df.c (print_header): Likewise.
	* src/factor.c (print_factors): Likewise.
	* src/ls.c (print_long_format, print_file_name_and_frills): Likewise.
	* src/shred.c (dopass): Likewise.
	* src/sort.c (checkfp): Likewise.
	* src/sum.c (bsd_sum_file, sysv_sym_file): Likewise.
	* src/tail.c (xlseek): Likewise.
	* src/wc.c (write_counts, wc): Likewise.

	* src/df.c (human_output_opts): New var.
	(output_block_size): Now uintmax_t, not int, to handle larger
	block sizes.  All uses changed.
	* src/du.c: Likewise.
	* src/ls.c: Likewise.

	* src/df.c (print_header): In the header line, prefer SI to human
	representation if it's shorter; if neither is shorter, try to
	intuit what the user would prefer.

	* src/expr.c (inttostr): Remove; use new imaxtostr library
	function instead.

	* src/ls.c (file_output_block_size): New var, to distinguish
	file sizes from other sizes.
	(decode_switches): Set it.

	* src/shred.c (OUTPUT_BLOCK_SIZE): remove.
	(dopass): When printing progress, use floor for what has been done
	so far (since we should be conservative there), and ceiling for
	what needs to be done (since that's what other programs use).

2002-10-19  Jim Meyering  <jim@meyering.net>

	* src/pinky.c (print_heading): Align TTY and Name headings.
	Reported by Karl Eichwalder.

2002-10-18  Jim Meyering  <jim@meyering.net>

	* src/split.c (cwrite): Change type of `bytes' parameter to size_t
	Remove now-useless cast.
	(stdread): Remove function.
	(bytes_split): Use size_t instead of int.
	Use safe_read, not stdread.
	(lines_split): Likewise.
	Use memchr rather than a `while' loop.
	(line_bytes_split): Use size_t instead of int.
	Use safe_read, not stdread.
	(main): Add some FIXME comments to remind me to remove casts.

	* src/system.h (ST_BLKSIZE): Correct comment describing how to
	reproduce HPUX-11 cat failure.  From Petter Reinholdtsen.

2002-10-17  Jim Meyering  <jim@meyering.net>

	Fix a problem that could make e.g., `cat' misbehave on systems which
	give invalid (unreasonably large) values for stat.st_blksize.
	* src/system.h (ST_BLKSIZE): Ensure that the result is in [1..4MB].
	Reported by Petter Reinholdtsen.

2002-10-14  Jim Meyering  <jim@meyering.net>

	Specifying a printf conversion specifer as nl's separator string
	could cause nl to segfault.
	* src/nl.c (build_print_fmt): Don't include separator string
	in the printf format; it might contain `%'.
	Use a better bound on the length of the print_fmt buffer.
	(print_lineno): Print the separator here instead.
	Reported by Doug Coleman.

	* tests/misc/nl: New file/tests, including a test for the above.
	* tests/misc/Makefile.am (TESTS): Add nl.

	* tests/misc/split-l: New test, to make sure `split --lines=N' works.
	* tests/misc/Makefile.am (TESTS): Add split-l.

2002-10-13  Jim Meyering  <jim@meyering.net>

	* Version 4.5.3.

	* src/du.c (usage): Tweak description of --dereference-args/-D.

	* src/du.c (count_entry): Also save cwd when dereferencing (via
	--dereference-args, -D) a command-line argument.
	Reported by Michal Svec.  Based on a patch by Andreas Schwab.

	* src/Makefile.am (../AUTHORS): New target/rule.

2002-10-12  Jim Meyering  <jim@meyering.net>

	* src/paste.c (paste_parallel): Declare local, `delims_saved', to be
	of type size_t, since that's the way it's used and avoids a warning.

	* src/csplit.c (struct cstring) [len]: Declare to be unsigned int,
	since that's how it's always used and avoids a new warning from gcc.
	(read_input): Adapt to new safe_read ABI.

	* src/cut.c (cut_fields): Add a temporary size_t variable, n_bytes,
	to avoid warnings.

	* src/pinky.c (print_long_entry): fread returns size_t.
	Declare local `bytes' accordingly, to avoid warning.

	tail -c +N would perform an extra read after encountering EOF
	[this change is analogous (bytes vs. lines) to the one of 2002-01-27]
	* src/tail.c (start_bytes): Detect EOF, inform caller.
	(tail_bytes): Upon EOF in start_bytes, return immediately.
	(file_lines): Reorganize to use memrchr rather than an explicit loop.
	Adapt to new safe_read ABI.

2002-10-11  Jim Meyering  <jim@meyering.net>

	* tests/du/deref: New file/test, for the above fix.
	* tests/du/Makefile.am (TESTS): Add deref.

2002-10-10  Jim Meyering  <jim@meyering.net>

	* tests/ln/Makefile.am (TESTS): Add target-1.
	* tests/ln/target-1: New file/test, for the fix on 2002-10-08.

2002-10-09  Jim Meyering  <jim@meyering.net>

	* tests/cp/backup-is-src: Ensure that certain environment variables
	are not set (e.g., SIMPLE_BACKUP_SUFFIX).  Reported by Duncan Roe.

	* tests/tail-2/big-4gb: Mark this as an expensive test; it would
	consume 4GB of disk space on systems without support for sparse files.
	Fix a logic error that'd make it `cat err' even though dd didn't fail.

	* src/dircolors.hin (.jar): Fix typo: s/;3$/;31/.
	Patch by steven@magelico.net, forwarded by Michael Stone.

	* tests/ls/dired: Ensure that ls produces English messages.
	Patch by Alexey Vyskubov, forwarded by Michael Stone.

2002-10-08  Dmitry V. Levin  <ldv@altlinux.org>

	* src/ln.c (main): Fix target_directory parsing when n_files == 1.

2002-10-08  Jim Meyering  <jim@meyering.net>

	* tests/tail-2/big-4gb: Use double quotes around diagnostic.
	Fix syntax in test: use =, not ==.
	Reported by Bob Proulx.
	Change all the rest like this: grep -lR "testing framework'" .\
	|xargs perl -pi -e 's/'\''(\$0: failure in testing framework)'\''/"$1"/'

	* src/sum.c (sysv_sum_file): Adapt to new safe_read ABI.
	* src/tr.c (squeeze_filter, read_and_delete, read_and_xlate): Likewise.
	* src/tac.c (save_stdin, tac_stdin_to_mem): Likewise.
	* src/wc.c (wc): Likewise.

2002-10-07  Paul Eggert  <eggert@twinsun.com>

	* src/cat.c (cat):
	Don't advance the write pointer past the end of the write buffer.
	* src/sort.c (begfield, limfield): Likewise.

2002-10-07  Jim Meyering  <jim@meyering.net>

	* src/cat.c (simple_cat, cat): Adapt to new safe_read ABI.
	* src/head.c (head_bytes, head_lines): Likewise.

2002-10-06  Jim Meyering  <jim@meyering.net>

	* src/dd.c (scanargs): Ensure that specified block sizes (specified
	via ibs=N, obs=N, and bs=N) are no larger than SSIZE_MAX.
	(skip, dd_copy): Adapt to new safe_read ABI.

	* Makefile.maint (signatures): Define.
	(%.sig): New rule.
	(announcement): Depend on $(signatures).

	* Makefile.maint (announcement): Output all URLs for detached
	signatures, not just the last one from the previous loop.

2002-10-05  Jim Meyering  <jim@meyering.net>

	* Version 4.5.2.

	* src/remove.c (remove_entry) [ROOT_CAN_UNLINK_DIRS]: With `rm -i DIR',
	don't recurse into directory, DIR.  Prompted by a report from
	Leonardo Milano.

	* tests/rm/i-no-r: New file/test, for the above fix.
	* tests/rm/Makefile.am (TESTS): Add i-no-r.

	* tests/tail-2/big-4gb: New file/test, for the fix of 2002-09-27.
	* tests/tail-2/Makefile.am (TESTS): Add big-4gb.

2002-10-03  Jim Meyering  <jim@meyering.net>

	* src/rm.c (AUTHORS): Mark translatable string with `N_ (...)'.
	* src/df.c (AUTHORS): Likewise.
	* src/du.c (AUTHORS): Likewise.
	* src/tail.c (AUTHORS): Likewise.
	* src/touch.c (AUTHORS): Likewise.

2002-10-02  Jim Meyering  <jim@meyering.net>

	* Makefile.am (SUBDIRS): Remove `old'.
	(EXTRA_DIST): List the files in old/.
	* configure.ac (AC_CONFIG_FILES): Remove old/* names.
	Suggestion from Akim Demaille.

2002-10-01  Jim Meyering  <jim@meyering.net>

	* src/sys2.h (SSIZE_MAX): Define.

2002-09-30  Jim Meyering  <jim@meyering.net>

	* src/csplit.c: Don't include stdlib.h here.  It's already included
	via system.h.

2002-09-29  Jim Meyering  <jim@meyering.net>

	* src/tr.c (find_bracketed_repeat): Rearrange pointer/integer
	expression to avoid bogus warning from gcc.

	* src/cat.c (simple_cat): Use a temporary to avoid bogus warnings.
	(cat): Declare insize and outsize to be of type size_t, not int.
	Rearrange pointer/integer expressions to avoid bogus warnings.
	(main): Declare insize and outsize to be of type size_t, not int.

	* src/tail.c (parse_options): Give a sensible diagnostic for
	an invalid byte or line count.  Reported by Mikko Tuumanen.

	* src/touch.c (main): Split a long line.

	* tests/du/Makefile.am (TESTS): Add slink.
	* tests/du/slink: New test for system.h change of 2002-08-31.

	In move mode, always first try to rename.  Before, upon failure to
	rename a directory, this code would never attempt to rename any
	other file in that directory, but would thenceforth always copy.
	On some systems (e.g., NetApp's OnTap-6.4), renaming a directory
	may fail with EXDEV, yet renaming files within that directory to
	a newly-created destination directory succeeds.
	* src/copy.c (copy_internal): Remove local, move_mode;
	use x->move_mode instead.  Based on a patch from Tom Haynes.

2002-09-28  Jim Meyering  <jim@meyering.net>

	* src/split.c (FAIL_ONLY_ONE_WAY): New macro.
	Factor out some duplication.
	(main): Use it.
	[case 'a']: Use strtoul rather than strtol to avoid compiler warnings.

	* src/sort.c (begfield, limfield): Rearrange comparisons to avoid
	compiler warnings.
	(fillbuf, keycompare): Cast literal `-1' to size_t in comparisons,
	to avoid compiler warnings.

	* src/shred.c (dopass): Use a uintmax_t temporary to avoid bogus
	compiler warnings.

	Fix things so `mkdir -p' can create very deep directories, e.g.,
	mkdir -p $(perl -e 'print "a/" x 40000') now works.
	* src/mkdir.c (main): For --parents (-p), call make_path with the
	entire directory name, so we don't ever require that file operations
	like stat or chmod be performed on the entire command line argument.
	* makepath.c (make_path): Restore umask *before* creating the final
	component.

2002-09-27  Andreas Schwab  <schwab@suse.de>

	* src/tail.c (tail_bytes): Change type of bytes_remaining to off_t
	to avoid overflow.  Reported by Hans Lermen.

2002-09-26  Jim Meyering  <jim@meyering.net>

	* src/install.c (get_ids): Use strtoul, not strtol.  Remove some casts.

2002-09-25  Jim Meyering  <jim@meyering.net>

	* src/test.c (eaccess): Change type of local `euid' from int to uid_t
	and add a cast, to avoid a warning about `signed and unsigned type in
	conditional expression'.

2002-09-22  Jim Meyering  <jim@meyering.net>

	* src/rmdir.c: Include "dirname.h", for declaration of
	strip_trailing_slashes.

	* src/stat.c (PRIdMAX, PRIuMAX): Remove definitions.
	Now they're defined through system.h.

	* src/cp-hash.c, src/dd.c, src/df.c, src/du.c, src/ls.c,
	* src/stat.c, src/wc.c: Remove all inclusions of inttypes.h,
	since it's already included from sys2.h via system.h.

	* Use automake-1.6f.  Regenerate dependent files.

	* src/Makefile.am (PERL): Remove duplicate definition.

	fmt's -s, -t, -c options didn't work properly for long lines.
	Since get_line may end up calling put_paragraph (for long lines),
	be sure to set global, `other_indent', before it is used there.

	* src/fmt.c (set_other_indent): New function, factored out of...
	(get_paragraph): ... here.  Call it.
	(get_line): Call set_other_indent before calling flush_paragraph,
	which calls fmt_paragraph, which in turn calls put_paragraph,
	which uses other_indent.

	* tests/fmt/Makefile.am (TESTS): Add long-line.
	* tests/fmt/long-line: New file/test, for the above fix.

2002-09-21  Jim Meyering  <jim@meyering.net>

	* src/od.c: No longer include deprecated <values.h>.
	It was required solely for now-removed reference to BITSPERBYTE.
	* src/install.c: Likewise.
	Suggestion from Bruno Haible.

2002-09-06  Andreas Schwab  <schwab@suse.de>

	`rmdir -p dir-specified-with-trailing-slash/' would fail.
	* src/rmdir.c (remove_parents): Strip trailing slashes.

2002-09-20  Jim Meyering  <jim@meyering.net>

	* tests/rmdir/t-slash: New file/test, for the above fix.
	* tests/rmdir/Makefile.am (TESTS): Add t-slash.

	* Makefile.maint (announcement): Arrange to gpg-sign the message.
	Add a URL for each detached signature file.

2002-09-07  Bruno Haible  <bruno@clisp.org>

	* configure.ac: Add need-ngettext to AM_GNU_GETTEXT invocation.

2002-09-18  Jim Meyering  <jim@meyering.net>

	`od -t x8' used the wrong (`l'-prefixed) printf format.
	Likewise for the o8 and u8 formats.
	* src/od.c (ISPEC_TO_FORMAT): Define macro.
	(decode_one_format): Use PRIdMAX, PRIoMAX, etc. for LONG_LONG.
	Reported by Arun Sharma.

2002-09-17  Jim Meyering  <jim@meyering.net>

	* src/sys2.h (PRIdMAX, PRIoMAX, PRIuMAX, PRIxMAX): Define if necessary.
	From gettext's intl/loadmsgcat.c.

	* tests/od/x8: New file/test, for the above fix.
	* tests/od/Makefile.am (TESTS): Add x8.

2002-09-15  Jim Meyering  <jim@meyering.net>

	* Use autoconf-2.54.  Regenerate dependent files.

	* src/csplit.c (get_format_width): Add cast to avoid
	warning about `signed and unsigned type in conditional expression'.

2002-09-14  Jim Meyering  <jim@meyering.net>

	* src/who.c (print_user): Change type of local to size_t
	to avoid warnings about `comparison between signed and unsigned'.
	* src/ptx.c (generate_all_output): Likewise.

	* src/dd.c (main, skip): Add casts to avoid warnings about
	`comparison between signed and unsigned'.

	* src/id.c (print_full_info, print_group_list): Add casts to avoid
	warnings about `signed and unsigned type in conditional expression'.

	* src/md5sum.c: Change type of global, digest_hex_bytes, to size_t
	to avoid warnings about `comparison between signed and unsigned'.
	(split_3): Change parameter names to be readable and add comment.
	Clean up the test for whether a line may be ignored.

2002-09-13  Jim Meyering  <jim@meyering.net>

	* src/printf.c (main): Handle leading command line argument of `--'.
	Reported by Raul: DervishD <raul@pleyades.net>
	* tests/misc/printf: New file: test for the above.
	* tests/misc/Makefile.am (TESTS): Add printf.

	* src/date.c (usage): Explain that %S's range of [0..60] is required --
	rather than 0..59 -- to accommodate the occasional positive leap second.
	Reported by Richard Neill.

2002-09-12  Jim Meyering  <jim@meyering.net>

	* src/Makefile.am (nanosec_libs): Define.
	(sleep_LDADD, tail_LDADD): Use it here.

	Factor nanosleep-related code into ../lib/xnanosleep.c.
	* src/sleep.c: Include xnanosleep.h.
	Factor out fenv.h-related code.
	(timespec_subtract): Remove function.
	(main): Remove code that deals with computing start and stop times
	as well as the loop around nanosleep.  Now that's in xnanosleep.c.

	Allow S (in --sleep-interval=S) to be a floating point value.
	* src/tail.c: Include xnanosleep.h and xstrtod.h.
	Move declaration of global variable, sleep_interval, to ...
	(main): ...here.
	(usage): Update description of --sleep-interval option.
	(tail_forever): New parameter, sleep_interval.  Update caller.
	Use xnanosleep, rather than sleep.
	(parse_options): New parameter, sleep_interval.  Update caller.
	Use xstrtod, now that we accept floating point values.
	Prompted by a patch from Augey Mikus.

2002-09-06  Jim Meyering  <jim@meyering.net>

	* src/remove.c (prompt): Change comment to give a better note to
	translators.  From Michael Piefel.

2002-09-02  Jim Meyering  <jim@meyering.net>

	* README: A good problem report/patch includes diffs against
	the most recent test release.

	* src/pathchk.c (NEED_PATHCONF_WRAPPER): Define.
	(pathconf_wrapper): Define only if NEED_PATHCONF_WRAPPER is set.

	* src/kill.c (print_table_row): Use an unsigned type for widths
	to avoid warning about comparison between signed and unsigned.
	(list_signals): Likewise.

	* src/od.c (skip): Add a cast to avoid warning about comparison
	between signed and unsigned.
	* src/install.c (get_ids): Likewise.  Also rearrange range-checking
	comparisons to make them more readable.

2002-09-01  Jim Meyering  <jim@meyering.net>

	* Version 4.5.1.

2002-08-31  Jim Meyering  <jim@meyering.net>

	Symlinks were always reported as using 0 blocks.
	* src/system.h (ST_NBLOCKS): Don't depend on file type.
	This reverts the change of 2000-01-30.
	Based on a report and patch from Neil Brown via Michael Stone.
	This fixes Debian Bug#156358.

	* Most files: Change `exit (0)' to `exit (EXIT_SUCCESS)',
	`exit (1)' to `exit (EXIT_FAILURE)', and
	`usage (1)' to `usage (EXIT_FAILURE)'.

	* chgrp.c, chmod.c, chown.c, chroot.c, cp.c, date.c, dd.c, du.c,
	* hostname.c, id.c, install.c, ln.c, mkdir.c, mkfifo.c, mknod.c,
	* nice.c, pinky.c, printf.c, pwd.c, shred.c, sleep.c, stty.c,
	* su.c, tac-pipe.c, tail.c, tee.c, touch.c, uname.c, uptime.c,
	* users.c, who.c: Change `error (1, ...' to `error (EXIT_FAILURE, ...'.
	But don't change `error (0, ...' to `error (EXIT_SUCCESS, ...', since
	error never exits successfully.

2002-08-29  Jim Meyering  <jim@meyering.net>

	* src/remove.c (remove_cwd_entries): Use closedir (not CLOSEDIR)
	when ignoring any return value.

	* src/remove.c (remove_cwd_entries): Detect and diagnose readdir
	failures.  On some systems (at least EMC Celerra and Solaris5.8),
	this appears to be necessary.
	(is_empty_dir): Likewise.  Also, always close directory handle.
	* src/ls.c (print_dir): Likewise.
	(print_dir): Rename local variable: reading -> dirp.
	Reported by Mike Coleman.

2002-08-28  Jim Meyering  <jim@meyering.net>

	* src/remove.c (remove_cwd_entries): Use CLOSEDIR, not closedir.
	Give a diagnostic and fail if closedir fails.

2002-08-26  Jim Meyering  <jim@meyering.net>

	* Makefile.am (THANKS-to-translators): New rule.
	(EXTRA_DIST): Add both THANKS-to-translators and THANKStt.in.
	* THANKStt.in: New file.

	* src/cat.c (close_stdout_wrapper): New, kludgey, function and
	file-scoped global.
	(main): Register it with atexit.
	Close STDOUT_FILENO, to avoid a problem when writing to
	/dev/audio on at least Solaris 2.7 and 2.8 systems.
	Reported by Shing-Shong Shei.

2002-08-25  Jim Meyering  <jim@meyering.net>

	* src/cat.c (main): Close STDIN_FILENO rather than a literal `0'.
	* src/tac.c (main): Likewise.
	* src/tail.c (main): Likewise.
	* src/tee.c (main): Likewise.
	* src/tr.c (main): Likewise.
	* src/wc.c (main): Likewise.

2002-08-20  Jim Meyering  <jim@meyering.net>

	* tests/mv/setup: Rewrite not to use `: ${VAR=not_set}' paradigm.

2002-08-10  Paul Eggert  <eggert@twinsun.com>

	* src/nohup.sh: Don't use "exec --"; it's not portable and
	shouldn't be needed.

2002-08-09  Jim Meyering  <jim@meyering.net>

	* src/pr.c (main): Don't ignore -COLUMN if it's the last option.
	(usage): Clarify help text for the -COLUMN option.
	Patch by Padraig Brady.
	* tests/pr/Test.pm [col-last]: New test for the above.

	* configure.ac: Start with version 4.5.1, chosen so that it's larger
	than the latest version numbers of the component packages.

	* man/Makefile.am (check-x-vs-1): Set and export PATH so we use
	programs in ../src.

2002-08-08  Jim Meyering  <jim@meyering.net>

	* src/date.c: Guard inclusion of <langinfo.h> with
	`#if HAVE_LANGINFO_CODESET', not `#if HAVE_LANGINFO_H'.
	* src/sort.c: Likewise.
	Patch by GOTO Masanori.

2002-08-05  Paul Eggert  <eggert@twinsun.com>

	Fix some minor time-related bugs with POSIX time arguments.
	Some valid time stamps were being rejected (notably -1, and
	time stamps before 1900 on 64-bit hosts).  And some invalid
	time stamps were being accepted, e.g. September 31.

	* src/date.c (main): Adjust to posixtime signature change.
	* src/touch.c (main): Likewise.  Remove unnecessary initialization.
	Use localtime, not posixtm, to warn about obsolete "touch".

2002-08-05  Jim Meyering  <jim@meyering.net>

	* tests/misc/Makefile.am (TESTS): Add nice and pathchk1.

2002-08-04  Jim Meyering  <jim@meyering.net>

	* src/Makefile.am (check-README): New target/rule.
	(check): Depend on it.

	* configure.ac (AC_CONFIG_FILES): Add old/Makefile and old/*/Makefile.

2002-08-03  Jim Meyering  <jim@meyering.net>

	* Makefile.am (SUBDIRS): Add old.
	* old/: New directory, containing legacy ChangeLog* and NEWS files
	from the fileutils, sh-utils, and textutils packages.

	* src/Makefile.am (AM_INSTALLCHECK_STD_OPTIONS_EXEMPT): Set to false.

2002-08-02  Paul Eggert  <eggert@twinsun.com>

	* NEWS, doc/coreutils.texi: uniq now obeys LC_COLLATE.

	* src/uniq.c: Include hard-locale.h, xmemcoll.h.
	(hard_LC_COLLATE): New var.
	(different): Args are now char *, not const char *.
	Use xmemcoll instead of memcmp to compare lines, so that
	LC_COLLATE has effect.  However, use memcmp if it is an
	easy locale.
	(check_file): Do not include newline in comparison, so that
	xmemcoll has a byte to stomp on temporarily.
	(main): Set hard_LC_COLLATE.

2002-07-29  Jim Meyering  <jim@meyering.net>

	* Makefile.am (SUBDIRS): Remove djgpp, for now.

2002-07-08  Jim Meyering  <jim@meyering.net>

	* src/Makefile.am (uninstall-local): Search for @GNU_PACKAGE@,
	rather than the hard-coded `sh-utils'.

2002-07-01  Jim Meyering  <jim@meyering.net>

	* configure.ac: Merge the three files from fileutils,
	textutils, and sh-utils.
	* Makefile.am: Likewise.
	* src/Makefile.am: Likewise.

Local Variables:
version-control: never
End:
