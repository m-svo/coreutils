1998-03-15  Jim Meyering  <meyering@eng.ascend.com>

	* Version 3.16n.

	* configure.in: Use jm_PREREQ_ERROR.

1998-03-14  Jim Meyering  <meyering@eng.ascend.com>

	Revert most `getdate.h -> get-date.h' changes of 1998-02-20.
	With automake-1.2f, that hack is no longer needed.

	* src/remove.c: Use `virtual memory exhausted' message, not
	`Memory exhausted' to be consistent with the majority of other
	such messages.
	Say `removing all...', not `removing any...'.
	* src/rmdir.c (remove_parents): Be consistent with documentation of
	--verbose option and with remove.c in saying `removing...' before
	the operation is attempted.
	(main): Likewise.
	Suggestions from Santiago Vila.

	* src/copy.c (copy_dir): Add new parameter, copy_into_self, and set it.
	(copy_internal): Likewise.
	(copy): Likewise.
	Update all callers.
	* src/copy.h (copy): Update prototype.
	* src/cp.c (do_copy): Add unused arg in calls to copy.
	* src/mv.c (do_move): Add &copy_into_self arg in call to copy.
	Don't remove source directory when copy_into_self is nonzero.
	Reported by Arne Henrik Juul.

	* tests/mv/into-self: Test for the above.
	* tests/mv/Makefile.am (TESTS): Add into-self.

1998-02-28   Eli Zaretskii  <eliz@is.elta.co.il>

	* userspec.c (parse_user_spec) [__DJGPP__]: Make function know
	about any arbitrary user and group by pretending to be the user
	and to belong to the group specified in `spec_arg' argument.

	* idcache.c (getuidbyname) [__DJGPP__]: Make function know about
	any arbitrary user name.
	(getgidbyname) [__DJGPP__]: Make function know about any arbitrary
	group name.

1998-02-24  Jim Meyering  <meyering@eng.ascend.com>

	* lib/xstrtol.c (TYPE_SIGNED): Define.
	(TYPE_MAXIMUM): Define.
	(ULONG_MAX): Use TYPE_MAXIMUM.
	(LONG_MAX): Use TYPE_MAXIMUM.

	* lib/fnmatch.c: Update from libit.
	* lib/idcache.c: Update from libit.

1998-02-23  Paul Eggert  <eggert@twinsun.com>

	* lib/quotearg.h, lib/quotearg.c: New files.
	* lib/Makefile.am (libfu_a_SOURCES): Add quotearg.c.
	(noinst_HEADERS): Add quotearg.h.

	* src/ls.c: Include new file quotearg.h.
	(enum indicator_style): Rename all to classify, and not_programs
	to file_type, to match option spellings.  All users changed.
	(indicator_style_args): New constant.
	(quote_funny_chars, quote_as_string, quote_shell): Remove;
	(filename_quoting_options, dirname_quoting_options): Use these
	variables instead.
	(long_options): Add --indicator-style, --quoting-style,
	--show-control-chars.  Remove --quote-shell.
	(dired_dump_obstack): Remove style parameter and don't output style.
	(main): Go back to previous method of outputting //DIRED//
	and //SUBDIRED// lines, without style.  But add a new
	//DIRED-OPTIONS// line that does output style.
	(decode_switches, usage): Add --indicator-style, --quoting-style,
	--show-control-chars.  Remove --quote-shell.
	(decode_switches): Default from QUOTING_STYLE environment variable.
	Set new quoting vars.
	(quote_name): Renamed from quote_filename.
	Take new arg specifying quoting options.
	Always print; do not have a special case for null FILE * argument.
	All callers changed.
	Move the guts of this function to new file quotearg.c.
	(length_of_file_name_and_frills): Use quotearg_buffer instead
	of (old) quote_filename to find length of file name.

	(decode_switches, parse_ls_color, print_dir, gobble_file,
	get_link_name):	Quote output in diagnostics.

	* NEWS, doc/fileutils.texi: Describe above changes.
	* doc/fileutils.texi: Mention that control characters are output
	as question marks if output is a terminal.

1998-02-22  Jim Meyering  <meyering@eng.ascend.com>

	* Version 3.16m.

	* ChangeLog-1997: New file.
	* Makefile.am (EXTRA_DIST): Add ChangeLog-1997.

1998-02-21  Jim Meyering  <meyering@eng.ascend.com>

	* configure.in (AC_OUTPUT): Add tests/mv/Makefile.
	* tests/Makefile.am (SUBDIRS): Add mv.
	* tests/mv: New directory
	* tests/mv/mv-special-1: New test.

1998-02-20  Jim Meyering  <meyering@eng.ascend.com>

	* src/touch.c: Include get-date.h.
	Remove get_date decl.

	* lib/getdate.h: Removed.  Could cause confusion with an
	automake-generated `.y.h' rule.
	* lib/get-date.h: Renamed from getdate.h.
	* lib/getdate.y: s/getdate.h/get-date.h/
	* lib/Makefile.am (noinst_HEADERS): s/getdate.h/get-date.h/

1998-02-19  Jim Meyering  <meyering@eng.ascend.com>

	1997-10-17  Eli Zaretskii  <eliz@is.elta.co.il>
	* lib/fileblocks.c [__DJGPP__]: Add missing typedef for daddr_t.

1998-02-13  Jim Meyering  <meyering@eng.ascend.com>

	* src/mv.c (cp_option_init): Set copy_as_regular to 0, not 1.
	Otherwise, mv tries to open special files.
	Reported by Kjetil Torgrim Homme.

1998-02-08  Jim Meyering  <meyering@eng.ascend.com>

	* Makefile.maint (cvs-dist): Update po/ to clear modified status
	of *.po files before running cvs tag -c.

	* src/ln.c (usage): Reword to use `TARGET' and `LINK_NAME' in
	description.

1998-02-07  Jim Meyering  <meyering@eng.ascend.com>

	* GNUmakefile: New file.
	* Makefile.am (EXTRA_DIST): Add GNUmakefile.
	Don't include Makefile.maint from here.  It's included from GNUmakefile.

	* configure.in: Don't use AM_MAINTAINER_MODE.
	(jm_PERL): Use this.

	* src/Makefile.am (EXTRA_DIST): Remove dcgen.pl.  Add dcgen.
	(CLEANFILES): Remove dcgen.
	(dircolors.h): Use $(PERL).
	(.pl): Remove rule.

1998-02-01  Jim Meyering  <meyering@na-net.ornl.gov>

	* POTFILES.in: Add remove.c.  Reported by Santiago Vila.

1998-01-28  Jim Meyering  <meyering@na-net.ornl.gov>

	* src/df.c (print_header): Tweak format to align heading over
	last column of `df -i' output.  From Andreas Schwab.

1998-01-27  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* Makefile.am: Include Makefile.maint from $(srcdir).

1998-01-25  Jim Meyering  <meyering@na-net.ornl.gov>

	* Version 3.16l.

	* Makefile.maint: New file.
	* Makefile.am: Move rules common to textutils, fileutils, sh-utils
	into Makefile.maint.
	Include Makefile.maint.
	(EXTRA_DIST): Add Makefile.maint.

	* src/cp.c (re_protect): Don't fail for non-root when chown fails
	due not only to lack of permission (EPERM), but also to lack of
	support (EINVAL).  Reported by Bengt Martensson.
	* src/copy.c (DO_CHOWN):  Likewise.

1998-01-24  Jim Meyering  <meyering@na-net.ornl.gov>

	* tests/ls/time-1 (test_failure): Rename does not update ctime;
	link does -- so use ln, not mv.
	Note that the SunOS4.1.4 failure of the ctime test is expected.

	* src/system.h (TYPE_MINIMUM): Add extra outer cast to work around
	bug in Cray C 5.0.3.0 when T == time_t.

	* tests/rm/r-1: Adjust expected output for changed format of
	`rm --verbose'.
	* tests/rm/r-2: Likewise.

1998-01-23  Jim Meyering  <meyering@na-net.ornl.gov>

	* lib/mktime.c (__mktime_internal): Work around bug in Irix4.0.5's
	C compiler.  From Kaveh Ghazi.
	(TYPE_MINIMUM): Define.
	(TYPE_MAXIMUM): Define.
	(TIME_T_MIN): Use TYPE_MINIMUM.
	(TIME_T_MAX): Use TYPE_MAXIMUM.

1998-01-22  Jim Meyering  <meyering@na-net.ornl.gov>

	* src/dd.c: Reorder functions to obviate forward dcls.
	(quit): Declare to be inline to stifle compile warning.

	* src/cp.c (do_copy): Add unreachable `return 0' to stifle warning.

	* tests/rm/sunos-1: Don't use -f.  Do adjust $RM if it's a
	relative path.

	* tests/ls/time-1: Use GNU touch to work around problems with NFS
	caching and/or clock skew.  Reported by Kaveh Ghazi.

	* tests/ls/Makefile.am (TESTS_ENVIRONMENT): Add TOUCH.

	* src/Makefile.am (noinst_HEADERS): Add remove.h.
	(mv_SOURCES): Define.
	(rm_SOURCES): Define.

1998-01-21  Jim Meyering  <meyering@na-net.ornl.gov>

	* src/install.c: Declare new global, backup_type.
	(main): Initialize backup_type unconditionally.
	(copy_file): Call find_backup_file_name with new argument, backup_type.
	* src/ln.c: Declare new global, backup_type.
	(main): Initialize backup_type unconditionally.
	(do_link): Call find_backup_file_name with new argument, backup_type.

	* src/copy.c (copy_internal): Use x->backup_type, not the global.
	(valid_options): Use VALID_BACKUP_TYPE and VALID_SPARSE_MODE.

	* src/copy.h: (VALID_SPARSE_MODE): Define.
	[struct cp_options] (backup_type): New member.

	* src/cp.c [NDEBUG]: Comment out definition.
	(do_copy): Use x->backup_type, not the global.

	* src/remove.c: New file.  Contains guts of old rm.c.
	(remove_init): New function.
	(remove_fini): New function.
	(rm): Take third argument, specifying options.
	* src/remove.h: New file.  Associated dcls.
	* src/rm.c: Remove and minimally librarify guts for use in mv.c.
	(main): Pass options (`&x') to rm.
	Call remove_init and remove_fini instead of open-coding them.

	* src/mv.c (rm_option_init): New function.
	(cp_option_init): New function.
	(copy_reg): Remove now-unused function.
	(do_move): Set up for and use `copy.c (copy)' in place of copy_reg.
	Set up for and use `remove.c (rm)' in place of unlink.

1998-01-20  Jim Meyering  <meyering@na-net.ornl.gov>

	* lib/backupfile.c: Use ANSI function definitions.
	Remove global declaration of backup_type.
	(simple_backup_suffix): Default to `~', not `.orig'.
	Use PARAMS, not __BACKUPFILE_P.
	(find_backup_file_name): Add parameter, backup_type.
	* lib/backupfile.h: Remove extern declaration of backup_type.
	Use PARAMS, not __BACKUPFILE_P.
	(VALID_BACKUP_TYPE): Define.
	(find_backup_file_name): Adjust prototype.

1998-01-13  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* src/df.c (print_header): Fix inode format header to line it up
        with the rest of the output.

1998-01-13  Jim Meyering  <meyering@na-net.ornl.gov>

	* lib/stat.c: Set errno to ENOENT, not EINVAL.  This is consistent
	with most other implementations.

1998-01-12  Jim Meyering  <meyering@na-net.ornl.gov>

	* lib/fileblocks.c: Include sys/param.h only #if HAVE_SYS_PARAM_H.
	Move function-spanning `#if ...BSIZE' directive to follow inclusion
	of sys/param.h since BSIZE is sometimes defined in sys/param.h.
	Reported by Philippe De Muyter.

1998-01-10  Jim Meyering  <meyering@na-net.ornl.gov>

	* Version 3.16k.

	* src/install.c (install_file_to_path): New function.
	FIXME: update fileutils.texi.
	(main): Handle new option, -D.
	Based on a patch from Marty Leisner.
	(usage): Describe -D.

	* src/ls.c (decode_switches) [-u]: Fix bug whereby -u worked only
	with -l or -t.  Now, -u (like -c) implies --sort=time.
	(usage): Correct descriptions of --sort, --time, and -t.
	Suggestions from Andreas Schwab.

	Add test for the above fix.
	* configure.in (AC_OUTPUT): Add tests/ls/Makefile.
	* tests/Makefile.am (SUBDIRS): Add ls.
	* tests/ls: New directory.
	* tests/ls/Makefile.am: New file.
	* tests/ls/time-1: New file.

	* lib/makepath.c (make_path): Reformat 3 if-stmts to test
	`if (newly_created_dir)' only once.  Suggestion from Andreas Schwab.

1998-01-06  Jim Meyering  <meyering@na-net.ornl.gov>

	* lib/getdate.y: Move inclusion of getdate.h and dependent extern
	declarations down so getdate.h's prototype follows the sometimes-
	enabled definition of `const' to nothing.  Otherwise, the prototype
	wouldn't match the definition because of the defined-away `const'.
	From Kaveh Ghazi.
	(get_date): ANSI-fy definition.
	Add %expect directive.

1998-01-05  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* lib/makepath.c (make_path): Put only newly created directories
        on the LEADING_DIRS list.

1998-01-05  Paul Eggert  <eggert@twinsun.com>

	* lib/fsusage.c (PROPAGATE_ALL_ONES): New macro.
	(get_fs_usage): If a value consists entirely of 1 bits,
	propagate this info to the output by setting it to (uintmax_t) -1.
	* src/df.c (df_readable): New function.
	(show_dev): If a value consists entirely of 1 bits, or is derived
	from some other value that consists entirely of 1 bits, report "-".
	Check inode and block counts more carefully for plausibility,
	to avoid arithmetic overflow when computing percentages.

1998-01-04  Jim Meyering  <meyering@na-net.ornl.gov>

	* Version 3.16j.

	* lib/Makefile.in: Regenerated with patched automake-1.2d.
	See README-alpha.

	* src/chgrp.c: Use a single enumerated type, Verbosity, instead of
	the two booleans, verbose and changes_only.  This fixes a bug whereby
	--change had the same effect as --verbose.
	* src/chmod.c: Likewise.
	* src/chown.c: Likewise.
	Reported by Paul Eggert.

1998-01-04  Paul Eggert  <eggert@twinsun.com>

	Check for write errors more carefully.

	* lib/Makefile.am (libfu_a_SOURCES): Add closeout.c.
	(noinst_HEADERS): Add closeout.h.
	* lib/closeout.c, lib/closeout.h: New files.
	* lib/long-options.c (parse_long_options),
	src/chgrp.c, src/chmod.c, src/chown.c, src/cp.c, src/dd.c,
	src/df.c, src/dircolors.c, src/du.c, src/install.c, src/ln.c,
	src/ls.c, src/mkdir.c, src/mkfifo.c, src/mknod.c, src/mv.c,
	src/mvdir.c, src/rm.c, src/rmdir.c, src/sync.c, src/touch.c
	(main, usage): Check for write error to stdout before exiting.
	Include "closeout.h".

1998-01-03  Jim Meyering  <meyering@na-net.ornl.gov>

	* src/df.c (show_dev): Treat `fsu.fsu_bavail == (unsigned long) -1'
	just like `fsu.fsu_blocks == 0' as an indicator that usage information
	is invalid.  This happens with Solaris-5.5.1 CD-ROM mount points.

	* lib/save-cwd.h: Guard PARAMS-enabling definition with
	`defined PROTOTYPES || (defined __STDC__ && __STDC__)' to avoid
	problems with Irix4's cc.  From Kaveh Ghazi.
	* lib/getdate.h: Likewise, but just to be consistent.

	* configure.in: Convert the .o suffix on files in LIBOBJS to $U.o so
	those files will be built via the ANSI2KNR-filtering rules if necessary.
	Reported by Kaveh Ghazi.

1998-01-02  Jim Meyering  <meyering@na-net.ornl.gov>

	* Version 3.16i.

	Fix problem with `install -d'.  Reported by Marty Leisner.

	* src/install.c (get_ids): When otherwise unspecified,
	set uid and gid to -1.
	* lib/makepath.c (make_path): Try to change ownership only if we've
	just created the directory.  Fix latent bug (s/&&/||/ in two places --
	also, note that it could not be exercised via install or mkdir)
	whereby chown would not be invoked when only one of owner/group is
	not -1.

1998-01-01  Jim Meyering  <meyering@na-net.ornl.gov>

	* src/rm.c (remove_cwd_entries): Initialize the entry-name obstack
	only once and never free it.

Local Variables:
version-control: never
End:
