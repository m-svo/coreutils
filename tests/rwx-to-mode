#!/bin/sh
# Convert an ls-style permission string, like drwxr----x and -rw-r-x-wx
# to the equivalent chmod --mode (-m) argument, (=,u=rwx,g=r,o=x and
# =,u=rw,g=rx,o=wx).

# FIXME: handle special bits, too.

case $# in
  1) rwx=$1;;
  *) echo "$0: wrong number of arguments" 1>&2
    echo "Usage: $0 ls-style-mode-string" 1>&2
    exit 1;;
esac

case $rwx in
  [ld-][rwx-][rwx-][rwxs-][rwx-][rwx-][rwxs-][rwx-][rwx-][rwxt-]) ;;
  *) echo "$0: invalid mode string: $rwx" 1>&2; exit 1;;
esac

u=`echo $rwx|sed 's/^.\(...\).*/,u=\1/;s/-//g;s/^,u=$//'`
g=`echo $rwx|sed 's/^....\(...\).*/,g=\1/;s/-//g;s/^,g=$//'`
o=`echo $rwx|sed 's/^.......\(...\).*/,o=\1/;s/-//g;s/^,o=$//'`
echo "=$u$g$o"
exit 0
